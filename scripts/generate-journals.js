const fs = require('fs');
const path = require('path');

const journalsPath = path.join(__dirname, '../external-assets/journals.txt');
const outputPath = path.join(__dirname, '../src/config/journals-generated.ts');

try {
  // Ensure output directory exists
  const outputDir = path.dirname(outputPath);
  if (!fs.existsSync(outputDir)) {
    fs.mkdirSync(outputDir, { recursive: true });
  }

  // Check if source file exists
  if (!fs.existsSync(journalsPath)) {
    console.warn('Warning: external-assets/journals.txt not found. Using empty list.');
    fs.writeFileSync(outputPath, 'export const journals: string[] = [];\n');
    process.exit(0);
  }

  const content = fs.readFileSync(journalsPath, 'utf-8');
  const journals = content
    .split('\n')
    .map(line => line.trim())
    .filter(line => line.length > 0 && !line.startsWith('#'));

  const fileContent = `// Auto-generated file. Do not edit manually.
// Generated by scripts/generate-journals.js

export const journals: string[] = ${JSON.stringify(journals, null, 2)};
`;

  fs.writeFileSync(outputPath, fileContent);
  console.log(`Successfully generated ${outputPath} with ${journals.length} journals.`);

} catch (err) {
  console.error('Error generating journals list:', err);
  process.exit(1);
}
