/**
 * Accessibility Utilities
 *
 * This file contains CSS utilities for improving web accessibility
 * according to WCAG 2.2 AA/AAA standards.
 */

/**
 * Screen Reader Only
 *
 * Hides content visually while keeping it accessible to screen readers.
 * Use for labels that provide context for assistive technology users
 * but would be redundant visually (e.g., "Search" label for a search input with placeholder).
 *
 * WCAG: Supports 1.3.1 Info and Relationships (Level A), 3.3.2 Labels or Instructions (Level AA)
 *
 * @example
 * <label htmlFor="search" className="sr-only">Search</label>
 * <input id="search" type="search" placeholder="Search articles..." />
 */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

/**
 * Screen Reader Only - Focusable
 *
 * Variant that becomes visible when focused.
 * Use for skip links or other navigation aids.
 *
 * WCAG: Supports 2.4.1 Bypass Blocks (Level A)
 *
 * @example
 * <a href="#main-content" className="sr-only-focusable">Skip to main content</a>
 */
.sr-only-focusable {
  @extend .sr-only;

  &:focus,
  &:active {
    position: static;
    width: auto;
    height: auto;
    margin: 0;
    overflow: visible;
    clip: auto;
    white-space: normal;
  }
}

/**
 * Visually Hidden
 *
 * Alternative name for .sr-only (more semantic).
 * Same functionality, different naming convention.
 */
.visually-hidden {
  @extend .sr-only;
}

/**
 * Focus Visible Utility
 *
 * Global focus indicator styles for better keyboard navigation.
 * Modern browsers support :focus-visible by default, but this ensures consistency.
 *
 * The --focus-color variable is automatically generated per journal theme
 * with a minimum contrast ratio of 3:1 against white backgrounds (WCAG AA).
 *
 * WCAG: Supports 2.4.7 Focus Visible (Level AA), 2.4.13 Focus Appearance (Level AAA - WCAG 2.2)
 *
 * @see src/config/theme.ts for --focus-color generation
 * @see docs/accessible_color_system.md for color system documentation
 */

/**
 * Universal Focus Indicator
 * Applies to all focusable elements when keyboard focus is used
 */
*:focus-visible {
  outline: 2px solid var(--focus-color, #0078d4);
  outline-offset: 2px;
  transition: outline 0.15s ease-in-out;
}

// Remove focus outline for mouse/touch users (but keep for keyboard)
*:focus:not(:focus-visible) {
  outline: none;
}

/**
 * Enhanced Focus Styles for Specific Elements
 *
 * Some elements need enhanced focus indicators for better visibility
 * or to work better with their existing styles.
 */

// Links - Enhanced contrast on hover + focus
a:focus-visible {
  outline: 2px solid var(--focus-color, #0078d4);
  outline-offset: 3px; // Extra space for better visibility around text
  border-radius: 2px;
}

// Buttons - Thicker outline for better visibility
button:focus-visible,
[role="button"]:focus-visible {
  outline: 3px solid var(--focus-color, #0078d4);
  outline-offset: 2px;
}

// Form inputs - Inner glow effect for better visibility
input:focus-visible,
textarea:focus-visible,
select:focus-visible {
  outline: 2px solid var(--focus-color, #0078d4);
  outline-offset: 0; // Flush with border for form elements
  box-shadow: 0 0 0 4px rgba(0, 120, 212, 0.1); // Subtle glow
}

// Checkboxes and radio buttons - Larger focus area
input[type="checkbox"]:focus-visible,
input[type="radio"]:focus-visible {
  outline: 3px solid var(--focus-color, #0078d4);
  outline-offset: 2px;
  box-shadow: none; // No glow for checkboxes/radios
}

/**
 * Skip Link
 *
 * Styles for skip-to-content links.
 * Hidden by default, visible when focused.
 *
 * WCAG: Supports 2.4.1 Bypass Blocks (Level A)
 */
.skip-link {
  position: absolute;
  left: -9999px;
  top: 0;
  z-index: 9999;
  padding: 1rem 2rem;
  background-color: var(--primary, #000);
  color: var(--button-text-on-primary-bg, #fff);
  text-decoration: none;
  font-weight: 600;
  border-radius: 0 0 4px 4px;

  &:focus {
    left: 50%;
    transform: translateX(-50%);
    top: 0;
    outline: 3px solid var(--focus-color, #0078d4);
    outline-offset: 2px;
  }
}

/**
 * Reduced Motion
 *
 * Respects user's prefers-reduced-motion preference.
 * Disables animations for users with vestibular motion disorders.
 *
 * WCAG: Supports 2.3.3 Animation from Interactions (Level AAA - WCAG 2.1)
 *
 * Note: Toast notifications are excluded from this rule because they need
 * to remain visible for their configured duration (autoClose timer).
 * The prefers-reduced-motion setting only affects decorative animations,
 * not the visibility duration of important UI messages.
 */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }

  // Override for toast notifications - they must keep their normal timing
  // to remain visible for the configured duration (WCAG 2.2.1 Level A)
  .Toastify__toast,
  .Toastify__toast-container,
  .Toastify__progress-bar,
  .Toastify__toast *,
  .Toastify__toast::before,
  .Toastify__toast::after {
    animation-duration: unset !important;
    animation-iteration-count: unset !important;
    transition-duration: unset !important;
  }

  // Critical: The progress bar animation must run at normal speed
  // because it controls the autoClose timer
  .Toastify__progress-bar--animated {
    animation-duration: var(--toastify-timer, 5000ms) !important;
  }
}

/**
 * Focus on Primary Background
 *
 * When focus occurs on elements with primary background color,
 * we use white outline for maximum visibility.
 *
 * Use this pattern for buttons/elements with background-color: var(--primary)
 */
.primary-bg,
[class*="primary"] {
  *:focus-visible,
  &:focus-visible {
    outline-color: var(--focus-color-on-primary, #ffffff);
    outline-width: 3px;
  }
}

/**
 * Focus on Dark Backgrounds
 *
 * Enhanced focus visibility on dark backgrounds (footer, dark sections)
 */
.dark-bg,
.footer,
[class*="dark"] {
  *:focus-visible,
  &:focus-visible {
    outline-color: var(--focus-color-on-dark, #ffffff);
    outline-width: 3px;
  }
}

/**
 * High Contrast Mode
 *
 * Ensures content remains visible in Windows High Contrast Mode.
 * Enhances focus indicators for users with vision impairments.
 *
 * WCAG: Supports 1.4.11 Non-text Contrast (Level AA - WCAG 2.1)
 */
@media (prefers-contrast: high) {
  // Stronger focus indicators in high contrast mode
  *:focus-visible {
    outline-width: 3px !important;
    outline-style: solid !important;
  }

  // Extra border for buttons and links
  button,
  a,
  input,
  select,
  textarea {
    outline: 1px solid transparent; // Becomes visible in high contrast
  }

  // Enhanced button/link focus
  button:focus-visible,
  a:focus-visible {
    outline-width: 4px !important;
  }
}
